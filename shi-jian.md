#### Redis服务器是一个事件驱动程序，服务器需要处理以下两类事件：



* **文件事件**（fileevent）：Redis服务器通过套接字与客户端（或者其他Redis服务器）进行连接，而文件事件就是服务器对套接字操作的抽象。服务器与客户端（或者其他服务器）的通信会产生相应的文件事件，而服务器则通过监听并处理这些事件来完成一系列网络通信操作。
    
    * 一个套接字执行连接应答、写入、读取、关闭等操作时， 就会产生一个文件事件 I/ O多路复用程序负责监听多个套接字， 并向文件事件分派器传送一个事件的套接字。如图下：
    
   ![](/assets/32CD2B56-2206-41D6-9D32-F61C6D748B16.png)
   
    
   
   
   
      * 队列存放了多个客服端并发的套接字，然后通过这个队列，以有序（sequentially）、同步（sync    hronously）、每次一个套接字的方式向文件事件分派器传送套接字。当上一个套接字产生的事件被处理完毕之后（该套接字为事件所关联的事件处理器执行完毕），I/O多路复用程序才会继续向文件事件分派器传送下一个套接字   


![](/assets/944FBDF9-A4FD-445A-9921-23116EBE7E8F.png)


* **时间事件**（timeevent）：Redis服务器中的一些操作（比如serverCron函数）需要在给定的时间点执行，而时间事件就是服务器对这类定时操作的抽象 一个时间事件主要由以下三个属性组成：
          * id：服务器为时间事件创建的全局唯一ID（标识号）ID号按从小到大的顺序递增，新事件的ID号比旧事件的ID号要大
          * when：毫秒精度的UNIX时间戳，记录了时间事件的到达（arrive）时间
          * timeProc：时间事件处理器，一个函数。当时间事件到达时，服务器就会调用相应的处理器来处理事件

 
 * 服务器将所有时间事件都放在一个无序链表中，每当时间事件执行器运行时，它就遍历整个链表，查找所有已到达的时间事件，并调用相应的事件处理器。因为新的时间事件总是插入到链表的表头，时间事件分别按ID逆序排序，表头事件的ID是最大的。如图：
 
      
![](/assets/EAE2C955-62C0-49AC-849D-D73E4F1B5A04.png)
           
                      
                                 
                                                       
> 注意: 保存时间事件的链表为无序链表，指的不是链表不按ID排序，而是说，该链表不按when属性的大小排序。正因为链表没有按when属性进行排序，所以当时间事件执行器运行的时候，它必须遍历链表中的所有时间事件，这样才能确保服务器中所有已到达的时间事件都会被处理。  



* **事件调度**

    因为服务器中同时存在文件事件和时间事件两种事件类型，所以服务器必须对这两种事件进行调度，决定何时应该处理文件事件，何时又应该处理时间事件，以及花多少时间来处理它们等等
    
  
   
  ![](/assets/FD6891E2-946B-460D-B13B-1D0507A67E17.png)