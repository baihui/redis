##### redis是由C编写的但是C字符串只会作为字符串字面量以及用在一些无须对字符串值进行修改的地方（日志打印），而redis使用结构体来表示字符串值，（SDS）也叫动态字符串。


* 一个SDS结构体代表一个字符串值
          
          ``` 
          struct sdshdr { 
          
           //SDS所保存字符串的长度
           int len ; 
           
           //记录buf数组中未使用字节的数量
           int free ; 
           
           //字节数组， 用于保存字符串 
           char buf[] ; 
          } ;
          
          ```
          
          * len 遵循C字符串以空字符结尾的惯例，保存空字符的1字节空间不计算在SDS的len属性里面



* **C字符串与SDS具有以下优点**

 * **获取字符串长度**
 
     C字符串需要遍历整个字符数组，而SDS直接记录在len 属性中
     
 * **杜绝缓冲区溢出和空间分配以及释放**
    
   与C字符串不同之处在于对字符串进行扩充时，SDS的API先进行判当前空间是否够用(free 记录)，否者申请一倍的空间（当前字符串小于1M）或者1M的空间(当前字符串已经大于30M) ，然后才执行实际的修改操作。 
   
   > * 通过空间预分配策略
     可以减少连续执行字符串增长操作所需的内存重分配次数。
   
   > * 惰性空间释放策略
     对SDS的字符串进行缩短操作时，api并不立即使用内存重分配来回收缩短后多出来的字节，而是使用free属性将这些字节的数量记录起来，并等待将来使用减少内存申请。(**SDS也提供真正释放未使用的空间的api**)
     
     
     
 
  
 * **二进制安全**
  
  C是这样定义字符串的：
  
  * 必须符合某种编码（比如ASCII）其次是字符串通过**空字符分割**来表示字符串结尾。
   > 在这种定义下C字符串只能保存文本数据，例如视频文件，或者其他文件数据中中途都会包含空字符串，这样最先被程序读入的空字符将被误认为是字符串结尾 。
   
   **而SDS是通过len属性来定义字符串结尾的，这样使得SDS可以存放如何二进制数据**
  
  
  
  ![](/assets/屏幕快照 2018-09-15 下午5.38.39.png)
  
  
  
