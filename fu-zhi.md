##### 主从同步是基于rdb文件的，如果开启了主从同步，即使你不开启rdb，也会默认自动生成的，不然无法进行数据同步

```
SLAVEOF < master_ ip> < master_ port>
```

* **连接**

* **通过PSYNC命令进行同步**
PSYNC命令具有完整重同步（fullresynchronization）和部分重同步（partialresynchr    onization）两种模式：
    
    * 其中完整重同步用于处理初次复制情况：完整重同步的执行步    骤和SYNC命令的执行步骤基本一样，它们都是通过让主服务器创建并发送RDB文件，以    及向从服务器发送保存在缓冲区里面的写命令来进行同步。
    
    * 而部分重同步则用于处理断线后重复制情况：当从服务器在断线后重新连接主服务器时，如果条件允许，主服务器可以将主从服务器连接断开期间执行的写命令发送给从服务器，从服务器只要接收并    执行这些写命令，就可以将数据库更新至主服务器当前所处的状态部分重同步功能由以下三个部分构成：
    
        * **主服务器的复制偏移量和从服务器的复制偏移量**。
        
            ![](/assets/屏幕快照 2018-09-09 下午6.37.21.png)
            通过对比主从服务器的复制偏移量，程序可以很容易地知道主从服务器是否处于一致状态
        * **主服务器的复制积压缓冲区**
            
            复制积压缓冲区里面会保存着一部分最近传播的写命令，并且复制积压缓冲 区会为队列中的每个字节记录相应的复制偏移量 来确认全部同步还是部分同步(如果offset偏移量之后的数据**（也即是偏移量offset+1开始的数据）仍然存在于复制积压缓冲区里面，那么主服务器将对从服务器执行部分重同步操作,否者完全同步) **         
           ![](/assets/redis.png)
           
           
               > 复制积压缓冲区是master服务器维护的固定长度，先进先出的队列（FIFO）默认大小1M
               通过修改redis.conf 中 repl-backlog-size **设置大小**
               Repl-backlog-size 公式计算 （slave（从服务器掉线平均秒）*master-writer（主服务器每秒的写入量））
               
        * **服务器的运行ID（runID）**
        
        当从服务器对主服务器进行初次复制时，主服务器会将自己的运行ID传送给从服务器，而从服务器则会将这个运行ID保存起来。主服务根据从服务传递的ID判断是否自己，如果不是自己的ID将会执行完整重同步。
        
         
    
* **命令传播  **

    当完成了同步之后,主从服务器就会进入命令传播阶段,这时主服务器只要一直将自己执行的写命令发送给从服务器，而从服务器只要一直接收并执行主服务器发来的写命令，就可以保证主从服务器一直保持一致了




* **心跳检测**





                            